{% extends 'layout/platform_dashboard_layout.html' %}
{% load static %}
{% block title %}
    é¡¹ç›®é¢æ¿
{% endblock %}
{% block css %}
<script src="{% static 'plugins/highcharts/highcharts.js' %}"></script>

<style>
    .status-count {
            text-align: center;
            margin-top: 10px;
            margin-bottom: 30px;
            font-size: 14px;
        }
    .status-count .count {
        font-size: 15px;
    }

    .status-count a {
        text-decoration: none;
    }
    .avatar {
            float: left;
            margin-right: 10px;
            display: inline-block;
            width: 30px;
            height: 30px;
            background-color: #304659;
            color: white;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
        }
    .comment-list .item {
            margin-top: 20px;
        }

    .comment-list .left-avatar {
        float: left;
        margin-right: 10px;
        display: inline-block;
        width: 30px;
        height: 30px;
        background-color: #304659;
        color: white;
        text-align: center;
        line-height: 30px;
        border-radius: 50%;
    }
    .comment-list pre {
        max-height: 35px;
        border: 1px solid #ccc;
        padding: 10px;

    }
    .comment-list .right-info {
        padding-left: 35px;
    }

    .comment-list .right-info .desc .msg {
        display: inline-block;
        padding-right: 20px;
        color: #8c8c8c;
        font-size: 12px;
    }
    .comment-list .child {
        padding-left: 55px;
    }
</style>
{% endblock %}
{% block body %}
<div class="row">
    <div class="col-md-8">
        <div class="col-md-12">
{#å±•ç¤ºé—®é¢˜è¶‹åŠ¿#}
            <div class="card project">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div><a>æ–°å¢é—®é¢˜è¶‹åŠ¿</a></div>
                </div>
                <div class="card-body">
                    <div id="container"></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
    {#å±•ç¤ºé—®é¢˜æ¦‚è§ˆ#}
                <div class="card project">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div><a>é—®é¢˜æ¦‚è§ˆ</a></div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% for key,item in status_dict.items %}
                                <div class="col-md-4 col-sm-6">
                                <div class="status-count">
                                    <a href="{% url 'issue' project_id=request.tracer.project.id %}?status={{ key }}">
                                        <div class="count">{{ item.count }}</div>
                                        <div>{{ item.text }}</div>
                                    </a>
                                </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
{# å±•ç¤ºé¡¹ç›®æˆå‘˜#}
            <div class="card project">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div><a>æˆå‘˜</a></div>
                </div>
                <div class="card-body">
                    <div class="col-sm-12 title">åˆ›å»ºè€…</div>
                    <div class="clearfix" style="margin-bottom: 30px;">
                        <div class="col-sm-4">
                            <div class="avatar">{{ request.tracer.project.creator.username.0|upper }}</div>
                            <div class="text">{{ request.tracer.project.creator.username }}</div>
                        </div>
                    </div>
                    <div class="col-sm-12 title">å‚ä¸è€…</div>
                    <div>
                        {% for item in user_list %}
                            <div class="col-sm-4">
                                <div class="avatar">{{ item.user.username.0|upper }}</div>
                                <div class="text">{{ item.user.username }}</div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>
{#å·¦å³åˆ’åˆ†#}
    <div class="col-md-4">
        <div class="col-md-12">
{#å±•ç¤ºé¡¹ç›®çŠ¶æ€ä¿¡æ¯#}
            <div class="card project">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div><a>é¡¹ç›®çŠ¶æ€</a></div>
                </div>
                <div class="card-body">
                    <table class="table table-right">
                            <tbody>
                            <tr>
                                <td class="label-left">é¡¹ç›®åç§° ï¼š</td>
                                <td>{{ request.tracer.project.name }}</td>
                            </tr>
                            <tr>
                                <td class="label-left">é¡¹ç›®æè¿° ï¼š</td>
                                <td>{{ request.tracer.project.desc }}</td>
                            </tr>
                            <tr>
                                <td class="label-left">åˆ›å»ºæ—¶é—´ ï¼š</td>
                                <td>{{ request.tracer.project.create_datetime }}</td>
                            </tr>
                            <tr>
                                <td class="label-left">é¡¹ç›®ç©ºé—´ ï¼š</td>
                                <td> {{ storage }}
                                </td>
                            </tr>
                            </tbody>
                        </table>
                </div>
            </div>
        </div>
        <div class="col-md-12">
{# å±•ç¤ºé¡¹ç›®åŠ¨æ€#}
            <div class="card project">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div><a>é¡¹ç›®åŠ¨æ€</a></div>
                </div>
                <div class="card-body comment-list">
                    {% for i in last_reply %}
                    <div class="item clearfix" id="{{ i.id }}" username="{{ i.creator }}">
                        <div class="left-avatar">{{ i.creator }}</div>
                        <div class="right-info">
                            <pre>{{ i.content }}</pre>
                            <div class="desc">
                                <div class="msg">
                                    âš™ï¸<span class="type">{{ i.get_reply_type_display }}</span>
                                    ğŸ‘¤<span class="user">{{ i.creator }}</span>
                                    ğŸ•’<span class="date">{{ i.create_datetime }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="child">
                        </div>
                    </div>
                    {%  endfor %}
                </div>
            </div>
        </div>
    </div>

</div>


{% endblock %}

{% block JavaScript %}
<script>

    $(function (){
       initTestChart();
    });
    function initTestChart(){
        Highcharts.setOptions({
        global: {
            useUTC: false
            }
        });
        var config = {
                title: {
                    text: null   // ä¸æ˜¾ç¤ºæ ‡é¢˜
                },
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle'
                },
                credits: {
                    enabled: false // å…³é—­ç‰ˆæƒä¿¡æ¯
                },
                yAxis: {
                    title: {
                        text: 'æ•°é‡' // Yå‘¨æ–‡æœ¬æç¤º
                    }
                },
                xAxis: {
                    type: 'datetime',
                    tickInterval: 60 * 60 * 24 * 1000,
                    labels: {
                        formatter: function () {
                            return Highcharts.dateFormat('%m-%d', this.value);
                        },
                        rotation: -30
                    }
                },
                tooltip: {
                    headerFormat: '<b>{point.key}</b><br>',
                    pointFormat: '<span style="color:{series.color}">\u25CF</span> æ•°é‡: {point.y} ',
                    xDateFormat: '%Y-%m-%d',
                },
                plotOptions: {
                    area: {
                        stacking: 'normal',
                        lineColor: '#666666',
                        lineWidth: 1,
                        marker: {
                            lineWidth: 1,
                            lineColor: '#666666'
                        }
                    }
                },
                series: [
                    {
                    name: 'é—®é¢˜æ–°å¢è¶‹åŠ¿',
                    data: []
                    },
                    {
                    name: 'é—®é¢˜å›å¤æ›´æ–°è¶‹åŠ¿',
                    data: []
                    }
                ]
            };
        $.ajax({
        url: '',
        type: 'POST',
        success: function(res) {
            // è¯·æ±‚æˆåŠŸæ—¶æ‰§è¡Œçš„æ“ä½œ
            console.log('Data received:', res);
            for (let i = 0; i < (res.data).length; i++) {
                config.series[i].data = res.data[i];
            }
            var chart = Highcharts.chart('container', config);
        },
        error: function(xhr, status, error) {
            // è¯·æ±‚å¤±è´¥æ—¶æ‰§è¡Œçš„æ“ä½œ
            console.error('Error:', error);
            // åœ¨è¿™é‡Œå¤„ç†é”™è¯¯æƒ…å†µ
        }
    });
    }
</script>

{% endblock %}