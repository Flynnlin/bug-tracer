{% extends 'layout/platform_layout.html' %}
{% block title %}é¡¹ç›®åˆ—è¡¨{% endblock %}
{% block css  %}
    <style>
    .project{
        margin-top: 10px;
    }
    .small-card{
        width: 700px;
    }
  .small-card-header {
    padding: 20px; /* è°ƒæ•´å°é¢æ¿ header çš„å†…è¾¹è· */
    font-size: 20px; /* è°ƒæ•´å°é¢æ¿ header çš„å­—ä½“å¤§å° */
    height: 110px; /* è®¾ç½®å°é¢æ¿ header çš„é«˜åº¦ */
    background-color: #ffffff; /* è®¾ç½®å°é¢æ¿ header çš„èƒŒæ™¯é¢œè‰² */
    border-bottom: 1px solid rgba(0, 0, 0, 0.125); /* è®¾ç½®å°é¢æ¿ header çš„åº•éƒ¨è¾¹æ¡† */
  }
  .small-card-body {
    padding: 10px; /* è°ƒæ•´å°é¢æ¿ body çš„å†…è¾¹è· */
    height: 40px; /* è®¾ç½®å°é¢æ¿ body çš„é«˜åº¦ */
  }
    </style>
{% endblock %}



{% block body %}
<div class="container-fluid project">

    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#creatProjectModal">âœ’ï¸åˆ›å»ºé¡¹ç›®</button>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#">ğŸ”—åŠ å…¥é¡¹ç›®</button>

</div>

<!-- æ·»åŠ é¡¹ç›®æ¨¡æ€æ¡† -->
<div class="modal fade" id="creatProjectModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">åˆ›å»ºé¡¹ç›®</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- åœ¨è¿™é‡Œæ·»åŠ æ¨¡æ€æ¡†å†…å®¹ -->
        <h1>âœ’ï¸æ–°å»ºé¡¹ç›®</h1>
        <form id="addProjectForm">
            {% csrf_token %}
            {% for field in form %}
                <div class="form-group">
                    <label>{{ field.label }}</label>
                        {{ field }}
                    <span class="errors" style="color: red"></span>
                </div>
            {% endfor %}
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
          <a id="addProjectBtn" type="button" class="btn btn-success">ä¿å­˜</a>
        <!-- å¦‚æœéœ€è¦æ·»åŠ å…¶ä»–æŒ‰é’®ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ  -->
      </div>
    </div>
  </div>
</div>

{#  å±•ç¤ºé¡¹ç›®  #}
{#  æˆ‘æ”¶è—çš„é¡¹ç›®  #}
<div class="card project" >
  <div class="card-header">
    ğŸ·ï¸æˆ‘æ”¶è—çš„é¡¹ç›®
  </div>
  <div class="card-body">
    <div class="row small-card">
      {% for item in project_dict.star %}
      <div class="col-md-4">
        <div class="card mb-3" style="border-color: {{ item.get_color_display }}">
          <a style="text-decoration:none" href="#">
              <div class="small-card-header" style="background-color: {{ item.get_color_display }}; color: white;">
              {{ item.name }}
            </div>
          </a>
        <div class="small-card-body d-flex justify-content-between align-items-center">
            <a style="text-decoration:none" href="{% url 'project_star' project_type='stared' project_id=item.id %}">â¤ï¸</a>
          ğŸ‘¤: {{ item.creator }}
          <span class="text-end ms-auto">ğŸ‘¥: {{ item.join_count }}</span>
        </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{#æˆ‘åˆ›å»ºçš„é¡¹ç›®#}
<div class="card project">
  <div class="card-header">
    ğŸ”¨æˆ‘åˆ›å»ºçš„é¡¹ç›®
  </div>
  <div class="card-body">
    <div class="row small-card">
      {% for item in project_dict.created %}
      <div class="col-md-4">
        <div class="card mb-3" style="border-color: {{ item.get_color_display }}">
          <div class="small-card-header" style="background-color: {{ item.get_color_display }}; color: white;">
            {{ item.name }}
          </div>
          <div class="small-card-body d-flex justify-content-between align-items-center">
              <a style="text-decoration:none" href="{% url 'project_star' project_type='my' project_id=item.id %}">ğŸ¤</a>
            ğŸ‘¤: {{ item.creator }}
            <span class="text-end ms-auto">ğŸ‘¥: {{ item.join_count }}</span>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

{#æˆ‘åŠ å…¥çš„é¡¹ç›®#}
<div class="card project">
  <div class="card-header">
    ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦æˆ‘åŠ å…¥çš„é¡¹ç›®
  </div>
  <div class="card-body">
    <div class="row small-card">
      {% for item in project_dict.joined %}
      <div class="col-md-4">
        <div class="card mb-3" style="border-color: {{ item.get_color_display }}">
          <div class="small-card-header" style="background-color: {{ item.get_color_display }}; color: white;">
            {{ item.name }}
          </div>
          <div class="small-card-body d-flex justify-content-between align-items-center">
            <a style="text-decoration:none" href="{% url 'project_star' project_type='join' project_id=item.id %}">ğŸ¤</a>

          ğŸ‘¤: {{ item.creator }}
          <span class="text-end ms-auto">ğŸ‘¥: {{ item.join_count }}</span>
            </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>











<!-- åœ¨é¡µé¢åº•éƒ¨æ·»åŠ ä¸€ä¸ª Toast å®¹å™¨ æ¥å¼¹å‡ºé€šçŸ¥-->
<div id="toastContainer" class="toast-container position-fixed bottom-0 end-0 p-3"></div>


{% endblock %}

{% block JavaScript %}
    <script type="text/javascript">
        $(function (){
            // é¡µé¢æ¡†æ¶åŠ è½½å®Œæˆåè‡ªåŠ¨æ‰§è¡Œçš„å†…å®¹
            addProjectBtnEvent(); // ç‚¹å‡»æ·»åŠ é¡¹ç›®ä¿å­˜æŒ‰é’®


        })

        function addProjectBtnEvent(){
            $('#addProjectBtn').click(function (){
                $.ajax({
                    url: '/project/list/',
                    type: 'POST', // å‘é€çš„è¯·æ±‚ç±»å‹ä¸ºGET
                    dataType: 'json', // é¢„æœŸè¿”å›çš„æ•°æ®ç±»å‹ä¸ºJSON
                    data:$("#addProjectForm").serialize(),
                    success: function (response){ // Ajaxè¯·æ±‚æˆåŠŸåçš„å›è°ƒå‡½æ•°
                        if (response.status){ // å¦‚æœè¿”å›çš„çŠ¶æ€ä¸ºæˆåŠŸ
                            location.reload(); // é‡æ–°åŠ è½½é¡µé¢
                            showToast('é€šçŸ¥','åˆ›å»ºæˆåŠŸ'); // å¼¹å‡ºè®¢å•åˆ é™¤æˆåŠŸçš„æç¤ºæ¡†
                        } else { // å¦‚æœè¿”å›çš„çŠ¶æ€ä¸ºå¤±è´¥
                            // å¾ªç¯éå†é”™è¯¯ä¿¡æ¯ï¼Œå¹¶å°†é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºåœ¨ç›¸åº”çš„è¡¨å•å­—æ®µä¸‹æ–¹
                            $.each(response.errors,function (name,value){
                                $("#id_"+name).next().text(value[0]);
                                console.log(name)
                            })

                        }
                    }
                });
            });
        }
        // ç”¨æ¥æ˜¾ç¤ºé€šçŸ¥
        function showToast(title, content) {
        // åˆ›å»º Toast å…ƒç´ 
        var toastElement = document.createElement('div');
        toastElement.classList.add('toast');
        toastElement.setAttribute('role', 'alert');
        toastElement.setAttribute('aria-live', 'assertive');
        toastElement.setAttribute('aria-atomic', 'true');

        // æ·»åŠ  Toast æ ‡é¢˜å’Œå†…å®¹
        toastElement.innerHTML = `
            <div class="toast-header">
                <strong class="me-auto">${title}</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                ${content}
            </div>
        `;

        // æ·»åŠ åˆ° Toast å®¹å™¨ä¸­
        document.getElementById('toastContainer').appendChild(toastElement);

        // åˆ›å»ºä¸€ä¸ª Bootstrap Toast å®ä¾‹å¹¶æ˜¾ç¤º
        var toast = new bootstrap.Toast(toastElement);
        toast.show();

        // Toast æ¶ˆå¤±åç§»é™¤ Toast å…ƒç´ 
        toastElement.addEventListener('hidden.bs.toast', function () {
            toastElement.remove();
        });
    }



    </script>
{% endblock %}
